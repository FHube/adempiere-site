"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[88088],{29899:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var r=a(34086);const n=(0,r._)("p",null,"本页面介绍的一系列 API 都是和小程序数据缓存(数据存储)相关的 API。",-1),s=(0,r._)("p",null,"可以利用数据缓存存储一些不重要的信息，比如用户的设置、用户的操作历史记录等。",-1),d=(0,r.uE)('<div class="custom-container tip"><p class="custom-container-title">概要</p><p><strong>最常用的三个</strong>:</p><p>异步:</p><ul><li><code>wx.setStorage</code>: 存储某个 <code>value</code> 到某个 <code>key</code></li><li><code>wx.getStorage</code>: 读取某个 <code>key</code> 的 <code>value</code></li><li><code>wx.removeStorage</code>: 删除某个 <code>key</code> 及其对应的 <code>value</code></li></ul><p>它们还有对应的同步 API 版本:</p><ul><li><code>wx.setStorageSync</code></li><li><code>wx.getStorageSync</code></li><li><code>wx.removeStorageSync</code></li></ul><p>清除缓存</p><ul><li><code>wx.clearStorage</code>: 清除全部数据缓存</li><li><code>wx.clearStorageSync</code>: 上方 API 的同步版本</li></ul></div><h2 id="相关注意事项" tabindex="-1"><a class="header-anchor" href="#相关注意事项" aria-hidden="true">#</a> 相关注意事项</h2><ul><li><p>除非用户主动删除或因存储空间原因被系统清理，否则数据都一直可用。</p><div class="custom-container warning"><p class="custom-container-title">注意</p><p>当系统空间不足或用户长时间不使用小程序时，数据缓存可能被清理。</p><p>所以要做好数据缓存丢失的逻辑。</p></div></li><li><p>单个 <code>key</code> 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。</p></li></ul><h2 id="wx-setstorage-object-object" tabindex="-1"><a class="header-anchor" href="#wx-setstorage-object-object" aria-hidden="true">#</a> wx.setStorage(Object object)</h2><p>将数据存储在本地缓存中指定的 <code>key</code> 中。会覆盖掉原来该 <code>key</code> 对应的内容。</p><h3 id="setstorage-参数" tabindex="-1"><a class="header-anchor" href="#setstorage-参数" aria-hidden="true">#</a> setStorage 参数</h3><p>Object object</p><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>string</td><td>是</td><td>本地缓存中指定的 key</td></tr><tr><td>data</td><td>any</td><td>是</td><td>需要存储的内容。只支持原生类型、Date、及能够通过 <code>JSON.stringify</code> 序列化的对象。</td></tr><tr><td>success</td><td>function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td>否</td><td>接口调用结束的回调函数(调用成功、失败都会执行)</td></tr></tbody></table><p>示例代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>wx.setStorage({\n  key: &quot;key&quot;,\n  data: &quot;value&quot;,\n});\n</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="wx-setstoragesync-string-key-any-data" tabindex="-1"><a class="header-anchor" href="#wx-setstoragesync-string-key-any-data" aria-hidden="true">#</a> wx.setStorageSync(string key, any data)</h2><p><code>wx.setStorage</code> 的同步版本</p><h3 id="setstoragesync-参数" tabindex="-1"><a class="header-anchor" href="#setstoragesync-参数" aria-hidden="true">#</a> setStorageSync 参数</h3><ul><li><p>string key</p><p>本地缓存中指定的 key</p></li><li><p>any data</p><p>需要存储的内容。只支持原生类型、Date、及能够通过 <code>JSON.stringify</code> 序列化的对象。</p></li></ul><p>示例代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>try {\n  wx.setStorageSync(&quot;key&quot;, &quot;value&quot;);\n} catch (err) {}\n</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="wx-getstorage-object-object" tabindex="-1"><a class="header-anchor" href="#wx-getstorage-object-object" aria-hidden="true">#</a> wx.getStorage(Object object)</h2><p>从本地缓存中异步获取指定 key 的内容</p><h3 id="getstorage-参数" tabindex="-1"><a class="header-anchor" href="#getstorage-参数" aria-hidden="true">#</a> getStorage 参数</h3><p>Object object</p><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>string</td><td>是</td><td>本地缓存中指定的 key</td></tr><tr><td>success</td><td>function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td>否</td><td>接口调用结束的回调函数(调用成功、失败都会执行)</td></tr></tbody></table><p>Object.success 回调函数</p><p>参数</p><p>Object res</p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>data</td><td>any</td><td>key 对应的内容</td></tr></tbody></table><p>示例代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>wx.getStorage({\n  key: &quot;key&quot;,\n  success: (res) =&gt; {\n    console.log(res.data);\n  },\n});\n</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="wx-getstoragesync-string-key" tabindex="-1"><a class="header-anchor" href="#wx-getstoragesync-string-key" aria-hidden="true">#</a> wx.getStorageSync(string key)</h2><p><code>wx.getStorage</code> 的同步版本</p><h3 id="getstoragesync-参数" tabindex="-1"><a class="header-anchor" href="#getstoragesync-参数" aria-hidden="true">#</a> getStorageSync 参数</h3><ul><li>string key: 本地缓存中指定的 <code>key</code></li></ul><h3 id="getstoragesync-返回值" tabindex="-1"><a class="header-anchor" href="#getstoragesync-返回值" aria-hidden="true">#</a> getStorageSync 返回值</h3><ul><li>any data : <code>key</code> 对应的内容</li></ul><p>示例代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>try {\n  const value = wx.getStorageSync(&quot;key&quot;);\n\n  if (value) {\n    // Do something with return value\n  }\n} catch (err) {\n  // Do something when catch error\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="wx-removestorage-object-object" tabindex="-1"><a class="header-anchor" href="#wx-removestorage-object-object" aria-hidden="true">#</a> wx.removeStorage(Object object)</h2><p>从本地缓存中移除指定 key</p><h3 id="removestorage-参数" tabindex="-1"><a class="header-anchor" href="#removestorage-参数" aria-hidden="true">#</a> removeStorage 参数</h3><p>Object object</p><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>string</td><td>是</td><td>本地缓存中指定的 key</td></tr><tr><td>success</td><td>function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td>否</td><td>接口调用结束的回调函数(调用成功、失败都会执行)</td></tr></tbody></table><p>示例代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>wx.removeStorage({\n  key: &quot;key&quot;,\n  success: (res) =&gt; {\n    console.log(res);\n  },\n});\n</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="wx-removestoragesync-string-key" tabindex="-1"><a class="header-anchor" href="#wx-removestoragesync-string-key" aria-hidden="true">#</a> wx.removeStorageSync(string key)</h2><p><code>wx.removeStorage</code> 的同步版本</p><h3 id="removestoragesync-参数" tabindex="-1"><a class="header-anchor" href="#removestoragesync-参数" aria-hidden="true">#</a> removeStorageSync 参数</h3><ul><li>string key: 本地缓存中指定的 <code>key</code></li></ul><p>示例代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>try {\n  wx.removeStorageSync(&quot;key&quot;);\n} catch (err) {\n  // Do something when catch error\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="wx-clearstorage-object-object" tabindex="-1"><a class="header-anchor" href="#wx-clearstorage-object-object" aria-hidden="true">#</a> wx.clearStorage(Object object)</h2><p>清理本地数据缓存</p><h3 id="clearstorage-参数" tabindex="-1"><a class="header-anchor" href="#clearstorage-参数" aria-hidden="true">#</a> clearStorage 参数</h3><p>Object object</p><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>success</td><td>function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td>否</td><td>接口调用结束的回调函数(调用成功、失败都会执行)</td></tr></tbody></table><p>示例代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>wx.clearStorage();\n</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="wx-clearstoragesync" tabindex="-1"><a class="header-anchor" href="#wx-clearstoragesync" aria-hidden="true">#</a> wx.clearStorageSync()</h2><p><code>wx.clearStorage</code> 的同步版本</p><p>示例代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>try {\n  wx.clearStorageSync();\n} catch (err) {\n  // Do something when catch error\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',59),c={},o=(0,a(82831).Z)(c,[["render",function(e,t){return(0,r.wg)(),(0,r.iD)(r.HY,null,[n,s,(0,r.kq)(" more "),d],64)}]])},82831:(e,t)=>{t.Z=(e,t)=>{const a=e.__vccOpts||e;for(const[e,r]of t)a[e]=r;return a}},41271:(e,t,a)=>{a.r(t),a.d(t,{data:()=>r});const r={key:"v-62fa99ca",path:"/code/mini-app/guide/service/api/storage.html",title:"数据缓存 API",lang:"zh-CN",frontmatter:{title:"数据缓存 API",icon:"storage",category:["小程序"],summary:"本页面介绍的一系列 API 都是和小程序数据缓存(数据存储)相关的 API。\n可以利用数据缓存存储一些不重要的信息，比如用户的设置、用户的操作历史记录等。\n",head:[["meta",{property:"og:url",content:"https://mrhope.site/code/mini-app/guide/service/api/storage.html"}],["meta",{property:"og:site_name",content:"Mr.Hope"}],["meta",{property:"og:title",content:"数据缓存 API"}],["meta",{property:"og:type",content:"article"}],["meta",{property:"og:updated_time",content:"2021-01-20T11:45:00.000Z"}],["meta",{property:"og:locale",content:"zh-CN"}],["meta",{property:"article:modified_time",content:"2021-01-20T11:45:00.000Z"}]]},excerpt:"<p>本页面介绍的一系列 API 都是和小程序数据缓存(数据存储)相关的 API。</p>\n<p>可以利用数据缓存存储一些不重要的信息，比如用户的设置、用户的操作历史记录等。</p>\n",headers:[{level:2,title:"相关注意事项",slug:"相关注意事项",children:[]},{level:2,title:"wx.setStorage(Object object)",slug:"wx-setstorage-object-object",children:[{level:3,title:"setStorage 参数",slug:"setstorage-参数",children:[]}]},{level:2,title:"wx.setStorageSync(string key, any data)",slug:"wx-setstoragesync-string-key-any-data",children:[{level:3,title:"setStorageSync 参数",slug:"setstoragesync-参数",children:[]}]},{level:2,title:"wx.getStorage(Object object)",slug:"wx-getstorage-object-object",children:[{level:3,title:"getStorage 参数",slug:"getstorage-参数",children:[]}]},{level:2,title:"wx.getStorageSync(string key)",slug:"wx-getstoragesync-string-key",children:[{level:3,title:"getStorageSync 参数",slug:"getstoragesync-参数",children:[]},{level:3,title:"getStorageSync 返回值",slug:"getstoragesync-返回值",children:[]}]},{level:2,title:"wx.removeStorage(Object object)",slug:"wx-removestorage-object-object",children:[{level:3,title:"removeStorage 参数",slug:"removestorage-参数",children:[]}]},{level:2,title:"wx.removeStorageSync(string key)",slug:"wx-removestoragesync-string-key",children:[{level:3,title:"removeStorageSync 参数",slug:"removestoragesync-参数",children:[]}]},{level:2,title:"wx.clearStorage(Object object)",slug:"wx-clearstorage-object-object",children:[{level:3,title:"clearStorage 参数",slug:"clearstorage-参数",children:[]}]},{level:2,title:"wx.clearStorageSync()",slug:"wx-clearstoragesync",children:[]}],git:{createdTime:1604856934e3,updatedTime:16111431e5,contributors:[{name:"Mr.Hope",email:"zhangbowang1998@gmail.com",commits:2}]},readingTime:{minutes:3.01,words:903},filePathRelative:"code/mini-app/guide/service/api/storage.md"}}}]);